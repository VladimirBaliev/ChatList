# План реализации программы ChatList

## Этап 1: Настройка проекта и зависимостей
1.1. Проверить и обновить `requirements.txt` с необходимыми библиотеками:
   - PyQt6 (для GUI)
   - requests или httpx (для HTTP-запросов)
   - python-dotenv (для работы с .env файлом)
   - sqlite3 (встроенная библиотека Python)

1.2. Создать файл `.env.example` с примером структуры для API-ключей
1.3. Создать файл `.gitignore` для исключения `.env` и других служебных файлов

## Этап 2: Проектирование и создание базы данных
2.1. Создать модуль `db.py` с функциями:
   - `init_database()` - инициализация БД и создание таблиц
   - Функции для работы с таблицей `prompts` (CRUD операции)
   - Функции для работы с таблицей `models` (CRUD операции)
   - Функции для работы с таблицей `results` (CRUD операции)
   - Функции для работы с таблицей `settings` (CRUD операции)

2.2. Реализовать создание всех таблиц согласно схеме из DATABASE.md
2.3. Добавить начальные данные (например, примеры моделей)
2.4. Протестировать работу с БД (создание, чтение, обновление, удаление)

## Этап 3: Модуль работы с моделями
3.1. Создать модуль `models.py`:
   - Класс или функции для управления моделями нейросетей
   - Функция получения списка активных моделей из БД
   - Функция получения API-ключей из .env файла
   - Валидация настроек моделей

3.2. Реализовать поддержку разных типов API (OpenAI, DeepSeek, Groq и т.д.)
3.3. Создать абстракцию для унификации работы с разными API

## Этап 4: Модуль сетевых запросов
4.1. Создать модуль `network.py`:
   - Функция отправки промта в конкретную модель
   - Обработка различных типов API (OpenAI, DeepSeek, Groq)
   - Обработка ошибок и таймаутов
   - Асинхронная отправка запросов в несколько моделей одновременно

4.2. Реализовать логирование запросов (опционально)
4.3. Добавить обработку исключений и retry-логику

## Этап 5: Основной интерфейс - структура окна
5.1. Обновить `main.py`:
   - Создать главное окно приложения
   - Разделить интерфейс на области:
     * Область ввода промта (текстовое поле или выбор из сохраненных)
     * Область выбора моделей (чекбоксы или список)
     * Область результатов (таблица с ответами)
     * Кнопки управления (Отправить, Сохранить, Очистить)

5.2. Реализовать меню приложения (Файл, Настройки, Помощь)
5.3. Добавить статус-бар для отображения состояния программы

## Этап 6: Функционал ввода промта
6.1. Реализовать текстовое поле для ввода нового промта
6.2. Создать выпадающий список или таблицу для выбора сохраненных промтов
6.3. Добавить возможность добавления тегов к промту
6.4. Реализовать сохранение нового промта в БД

## Этап 7: Функционал отправки запросов
7.1. Реализовать кнопку "Отправить":
   - Получение активных моделей из БД
   - Отправка промта во все активные модели через `network.py`
   - Отображение процесса загрузки (прогресс-бар или индикатор)

7.2. Создать временную структуру данных для хранения результатов в памяти
7.3. Обработать случаи ошибок при отправке запросов

## Этап 8: Интерфейс результатов
8.1. Создать таблицу для отображения результатов:
   - Колонка "Модель" (название модели)
   - Колонка "Ответ" (текст ответа, с возможностью прокрутки)
   - Колонка "Выбрано" (чекбокс для каждой строки)

8.2. Реализовать обновление таблицы при получении новых результатов
8.3. Добавить возможность сортировки по колонкам
8.4. Реализовать поиск по результатам (опционально)

## Этап 9: Сохранение результатов
9.1. Реализовать кнопку "Сохранить":
   - Получение всех строк с отмеченными чекбоксами
   - Сохранение выбранных результатов в таблицу `results` БД
   - Связывание результатов с промтом и моделью

9.2. Добавить подтверждение сохранения
9.3. Очистка временной таблицы после сохранения

## Этап 10: Управление промтами
10.1. Создать окно/панель управления промтами:
    - Просмотр всех сохраненных промтов
    - Редактирование промтов
    - Удаление промтов
    - Поиск и фильтрация по тегам

10.2. Реализовать поиск и сортировку в таблице промтов

## Этап 11: AI-ассистент для улучшения промтов

11.1. Создать модуль `prompt_improver.py`:
    - Функция `improve_prompt(original_prompt, model_id, improvement_type=None)`:
      * Принимает исходный текст промта от пользователя
      * Принимает идентификатор модели из БД для отправки запроса
      * Опциональный параметр `improvement_type`: 'code', 'analysis', 'creative' или None (общее улучшение)
      * Возвращает структурированный ответ с улучшенными вариантами промта

11.2. Реализовать логику формирования системного промта для AI-ассистента:
    - Создать шаблоны системных промтов для разных типов улучшения:
      * Общее улучшение промта (улучшенная версия + 2-3 варианта переформулировки)
      * Адаптация под код (техническая терминология, структура)
      * Адаптация под анализ (детализация, структурированность)
      * Адаптация под креатив (образность, выразительность)
    - Промт должен запрашивать:
      * Улучшенную версию исходного промта
      * 2-3 альтернативных варианта переформулировки
      * При необходимости — адаптированные версии под разные типы моделей

11.3. Интеграция с существующим модулем `network.py`:
    - Использовать существующую функцию отправки запросов к API через OpenRouter-клиент
    - Отправлять запрос в указанную модель с системным промтом для улучшения
    - Обрабатывать ответ и парсить структурированные данные (улучшенный промт + варианты)

11.4. Создать окно/диалог `PromptImproverDialog` в `main.py`:
    - Поля для отображения:
      * Исходный промт (read-only текстовое поле)
      * Улучшенный промт (текстовое поле с возможностью редактирования)
      * Секция с 2-3 альтернативными вариантами (список или вкладки)
      * Опциональная секция с адаптированными версиями для разных типов моделей
    - Элементы управления:
      * Выбор модели для улучшения (выпадающий список активных моделей)
      * Кнопка "Улучшить промт" для запуска процесса
      * Индикатор загрузки во время обработки
      * Кнопки "Подставить в поле ввода" для каждого варианта (улучшенный + альтернативы)
      * Кнопка "Отмена" для закрытия окна
      * Опционально: выбор типа улучшения (общее/код/анализ/креатив)

11.5. Интеграция кнопки "Улучшить промт" в основной интерфейс:
    - Добавить кнопку "Улучшить промт" рядом с полем ввода промта (в области Этапа 6)
    - При клике на кнопку:
      * Если в поле ввода есть текст, открывать `PromptImproverDialog` с этим текстом
      * Если поле пустое, показывать предупреждение или запрашивать ввод промта
    - После выбора варианта из диалога:
      * Подставлять выбранный текст в поле ввода промта
      * Закрывать диалог

11.6. Обработка ошибок и валидация:
    - Проверка наличия активных моделей перед открытием диалога
    - Обработка ошибок API (таймауты, неверный API-ключ, недоступность модели)
    - Валидация ответа от AI (проверка структуры, наличия всех требуемых вариантов)
    - Отображение понятных сообщений об ошибках пользователю

11.7. Парсинг ответа от AI:
    - Реализовать функцию парсинга ответа модели:
      * Определение улучшенной версии промта
      * Извлечение альтернативных вариантов (2-3 штуки)
      * Извлечение адаптированных версий для разных типов (если запрашивались)
    - Обработать различные форматы ответа:
      * JSON-структурированный ответ (предпочтительно)
      * Текстовый ответ с маркерами/разделителями
      * Список с нумерацией

11.8. Оптимизация и UX:
    - Кэширование последнего результата улучшения (чтобы не отправлять повторно при открытии диалога)
    - Возможность копирования любого варианта в буфер обмена
    - Автоматическое форматирование текста промтов (удаление лишних пробелов, переносов)
    - Подсветка синтаксиса для технических промтов (опционально)

11.9. Тестирование функции улучшения промтов:
    - Протестировать с различными типами промтов (короткие, длинные, технические, креативные)
    - Проверить работу с разными моделями
    - Протестировать обработку ошибок и edge cases
    - Проверить корректность парсинга ответов

## Этап 12: Управление моделями
12.1. Создать окно/панель управления моделями:
    - Добавление новых моделей
    - Редактирование настроек моделей (name, api-url, api-id)
    - Активация/деактивация моделей (is_active)
    - Удаление моделей

12.2. Валидация настроек моделей при добавлении/редактировании

## Этап 13: Просмотр сохраненных результатов
13.1. Создать окно/панель для просмотра сохраненных результатов:
    - Таблица с сохраненными результатами
    - Фильтрация по промту, модели, дате
    - Поиск и сортировка

13.2. Реализовать возможность удаления результатов

## Этап 14: Настройки приложения
14.1. Создать окно настроек:
    - Управление настройками из таблицы `settings`
    - Настройки интерфейса (тема, размер шрифта и т.д.)
    - Настройки работы с API (таймауты, retry и т.д.)

14.2. Реализовать функцию "О программе":
    - Создать диалоговое окно с краткой информацией о программе
    - Отобразить версию, автора, дату создания
    - Добавить ссылки на документацию (опционально)

## Этап 15: Экспорт данных (опционально)
15.1. Реализовать экспорт результатов в Markdown:
    - Форматирование данных
    - Сохранение в файл

15.2. Реализовать экспорт результатов в JSON:
    - Структурированное сохранение данных
    - Сохранение в файл

## Этап 16: Логирование (опционально)
16.1. Настроить систему логирования:
    - Логирование запросов к API
    - Логирование ошибок
    - Логирование действий пользователя

16.2. Создать окно просмотра логов

## Этап 17: Тестирование и отладка
17.1. Протестировать все основные функции:
    - Работа с БД
    - Отправка запросов к API
    - Сохранение и загрузка данных
    - Интерфейс пользователя
    - Функцию улучшения промтов

17.2. Исправить найденные ошибки
17.3. Оптимизировать производительность

## Этап 18: Финальная полировка
18.1. Улучшить пользовательский интерфейс (UI/UX)
18.2. Добавить обработку всех возможных ошибок
18.3. Создать README.md с инструкциями по установке и использованию
18.4. Подготовить релизную версию

